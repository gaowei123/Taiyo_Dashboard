
@{
    ViewBag.Title = "PQCOperatorPerformanceChart";
}

@*下拉框组件*@
<script src="~/Plugins/bootstrap-select-1.13.0/dist/js/bootstrap-select.min.js"></script>
<link href="~/Plugins/bootstrap-select-1.13.0/dist/css/bootstrap-select.min.css" rel="stylesheet" />

@*时间框组件*@
<script src="~/Plugins/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.js"></script>
<link href="~/Plugins/bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />

@*echart*@
<script src="~/plugins/incubator-echarts-master/dist/echarts.min.js"></script>



<div class="container">
    <div class="row titleRow">
        <img class="titleImg" src="~/Resources/Images/headericon.gif" />
        <span class="titleText">PQC Operator Performance Chart</span>
    </div>

    <div class="row searchingBar">
        <div class="col-sm-12 panel panel-default searchingPanel" style="padding-top:10px;">
            <div class="row form-inline searchingBar ">
                <div class="col-sm-3">
                    <label style="width:35%">Date From:</label>
                    <input type="text" class="form-control" id="txtDateFrom" 
                           CssClass="form-control formDateTimePicker"
                           data-date-format="yyyy-mm-dd"
                           placeholder="Please choose date" 
                           style="width:60%;" />
                </div>
                <div class="col-sm-3">
                    <label style="width:35%">Date To:</label>
                    <input type="text" class="form-control" id="txtDateTo" 
                           CssClass="form-control formDateTimePicker"          
                           data-date-format="yyyy-mm-dd"               
                           placeholder="Please choose date" 
                           style="width:60%;" />
                </div>
                <div class="col-sm-3">
                    @*<label for="ddlPIC" style="width:35%">PIC:</label>
                    <select id="ddlPIC" class="form-control selectpicker" data-ng-style="btn-info"></select>*@
                </div>
                <div class="col-sm-3" align="right" style="padding-right:2%;">
                    <input type="button" class="btn btn-success" value="Generate" onclick="generate();" />
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 panel panel-default" style="margin-top:10px;">
            <div id="divChart"></div>
        </div>
    </div>
</div>




<script type="text/javascript">

    var apiGetChartData = window.globalConfig.rootDirectory + '/Charts/GetPQCOperatorPerformanceData';
    var chart = echarts.init(document.getElementById('divChart'));

    $('#txtDateFrom').datetimepicker({
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
        initialDate: new Date()
    });
    $('#txtDateTo').datetimepicker({
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
        initialDate: new Date()
    });



    $(document).ready(function () {
        var today = dateFormat('yyyy-MM-dd', new Date());
        $('#txtDateFrom').val(today);
        $('#txtDateTo').val(today);

        generate();
    });

    

    function generate() {

        if ($("#txtDateFrom").val() == '') {
            alert('Date From can not be empty!');
            return false;
        }
        if ($("#txtDateTo").val() == '') {
            alert('Date To can not be empty!');
            return false;
        }





        $.ajax({
            type: "POST",
            dataType: "json",
            url: apiGetChartData,
            data: {
                DateFrom: $("#txtDateFrom").val(),
                DateTo: $("#txtDateTo").val(),
                //PIC: $('#ddlPIC').val()
            },

            beforeSend: function(){
                chart.showLoading();
            },

            success: function (data) {

                if (data == null || data.length == 0 || data==undefined) {
                    alert('No data found!');
                    return false;
                }

                var series = [];
                for (var i = 0; i < data.SeriesData.length; i++) {
                    series.push({
                        name: data.SeriesData[i].Name,
                        type: data.SeriesData[i].Type,
                        stack: data.SeriesData[i].Stack,
                        data: data.SeriesData[i].Data,
                        label: {
                            show: true,
                            position: 'inside',
                            formatter: function (data) {
                                if (data.data === 0) {
                                    return '';
                                } else {
                                    return data.data;
                                }
                            },
                            //color: 'black'
                        }
                    });
                }


                option = {

                    title: {
                        text: ''
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                            type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                        }
                    },
                    legend: {
                        data: data.LegendData
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: data.XAxisData,
                            axisLabel: {
                                interval: 0,
                                //formatter: function (value) {
                                //    return value.split('').join('\n');
                                //},
                                rotate: 45,
                            }
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value'
                        }
                    ],
                    series: series
                };

                chart.setOption(option, true);



                chart.clear();
                chart.setOption(option);
            },

            complete: function(){
                chart.hideLoading();
                chart.resize({ height: $(window).height()  - 300});
            },


            error: function (e) {
                alert("Get chart data error !");
                chart.hideLoading();
            }
        });

    }




    $(window).resize(function () {
        chart.resize({ height: $(window).height() - 300 });
    });


</script>